// Add this NEW function
function directTest() {
    const testUrl = DEPLOYMENT_URL + '?B=TEST123&C=TEST&Z=TestResult&timestamp=' + new Date().toISOString();
    console.log('Direct test URL:', testUrl);
    
    // Open in new tab
    window.open(testUrl, '_blank');
    
    // Also try fetch
    fetch(testUrl)
        .then(response => response.text())
        .then(text => {
            console.log('Direct test response:', text);
            try {
                const json = JSON.parse(text);
                if (json.success) {
                    alert('âœ… Test successful! Data saved to row ' + json.row);
                } else {
                    alert('âŒ Test failed: ' + (json.message || 'Unknown error'));
                }
            } catch {
                alert('âš ï¸ Got response: ' + text.substring(0, 100));
            }
        })
        .catch(error => {
            console.error('Direct test error:', error);
            alert('âš ï¸ Fetch failed, but new tab opened. Check Google Sheets.');
        });
}

// Update debugExport function to include direct test button
function debugExport() {
    const debugOutput = document.getElementById('debugOutput');
    const apiStatus = document.getElementById('apiStatus');
    
    if (!currentResults || Object.keys(currentResults).length === 0) {
        showApiStatus('Please analyze an order first', 'error');
        return;
    }
    
    // Prepare data
    const debugData = {
        B: currentResults.B || '12345',
        C: currentResults.C || 'AE',
        Z: currentResults.Z || 'Vendor Late',
        timestamp: new Date().toISOString()
    };
    
    const params = new URLSearchParams();
    Object.keys(debugData).forEach(key => {
        params.append(key, debugData[key]);
    });
    
    const url = DEPLOYMENT_URL + '?' + params.toString();
    
    debugOutput.innerHTML = `ğŸ” DEBUG INFO:
    
ğŸ“¤ Data being sent:
${JSON.stringify(debugData, null, 2)}

ğŸ”— URL being called:
${url}

ğŸ“‹ TEST OPTIONS:
1. <button onclick="window.open('${url}', '_blank')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px;">ğŸ“¤ Open Test Link</button>
2. <button onclick="directTest()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px;">ğŸ§ª Run Direct Test</button>

ğŸ› ï¸ TROUBLESHOOTING:
1. Click "Open Test Link" - a new tab should open with JSON response
2. Check Google Apps Script â†’ Executions for logs
3. Check Google Sheets for "Test Results" sheet
4. Ensure script is deployed with "Anyone" access
5. Check browser console (F12) for CORS errors`;

    debugOutput.style.display = 'block';
    showApiStatus('Debug info ready. Click the test buttons above.', 'info');
}
