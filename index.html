<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Analysis Tool - Complete</title>
    <style>
        /* All your existing CSS remains exactly the same */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-container {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .final-result {
            font-size: 24px;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .result-before-pdt {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .result-vendor-late {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        .result-rider-late {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .result-long-dispatch {
            background: #cce5ff;
            color: #004085;
            border: 2px solid #b8daff;
        }
        
        .result-on-time {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        
        .columns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .column-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .column-group h3 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.2em;
        }
        
        .column-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .column-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .column-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .column-value {
            color: #212529;
            font-weight: 500;
            font-size: 1.1em;
            word-break: break-all;
        }
        
        .time-value {
            color: #e83e8c;
            font-family: 'Courier New', monospace;
        }
        
        .seconds-value {
            color: #20c997;
            font-weight: 600;
        }
        
        .boolean-true {
            color: #28a745;
            font-weight: 600;
        }
        
        .boolean-false {
            color: #dc3545;
            font-weight: 600;
        }
        
        .column-note {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 3px;
            font-style: italic;
        }
        
        .formula-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
        }
        
        .formula-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .formula-step {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            display: none;
        }
        
        .debug-toggle {
            text-align: center;
            margin: 20px 0;
        }
        
        .debug-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .debug-btn:hover {
            background: #545b62;
        }
        
        .debug-info {
            background: #212529;
            color: #20c997;
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .api-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .api-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .api-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin: 10px 5px;
        }
        
        .api-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }
        
        .api-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .api-btn.test {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }
        
        .api-btn.debug {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .api-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            display: none;
        }
        
        .api-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .api-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .deployment-url {
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
            text-align: left;
        }
        
        .debug-output {
            background: #212529;
            color: #20c997;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            display: none;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }
        
        @media (max-width: 768px) {
            .columns-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Late Owner Analysis Tool</h1>
            <p>Created by talabat SSC Analytics Team.‚Äã </p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <label for="orderDetails">üìã Paste Order Details (Column A content):</label>
                <textarea id="orderDetails" placeholder="Paste the complete order details here..."></textarea>
            </div>
            
            <div class="error" id="errorMessage"></div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing order details...</p>
            </div>
            
            <div class="button-container">
                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeOrder()">üöÄ Analyze Order</button>
            </div>
            
            <div class="api-section">
                <h3>üìä Google Sheets Integration</h3>
                <p>Send the analyzed results directly to Google Sheets</p>
                <div class="deployment-url" id="deploymentUrlDisplay">
                    https://script.google.com/a/macros/talabat.com/s/AKfycbyq_uofMc9mgEGp2f9-0duQkf3K9Rzo4ZdtlKKG_f0dg2JT_tU5EeuWu1i6xGfnKAwz8g/exec
                </div>
                <button class="api-btn" id="exportBtn" onclick="exportToSheets()" disabled>üì§ Export Results</button>
                <button class="api-btn test" id="testBtn" onclick="testConnection()">üîß Test Connection</button>
                <button class="api-btn debug" id="debugBtn" onclick="debugExport()">üêõ Debug Export</button>
                <div id="apiStatus" class="api-status"></div>
                <div id="debugOutput" class="debug-output"></div>
            </div>
            
            <div class="result-container" id="resultContainer">
                <div class="result-header">
                    <div>
                        <h2>Analysis Result:</h2>
                        <p style="color: #666; margin-top: 5px;">Column Z equivalent calculation</p>
                    </div>
                    <div class="final-result" id="finalResult"></div>
                </div>
                
                <div class="columns-grid" id="columnsGrid">
                    <!-- Columns B-Z will be populated here -->
                </div>
                
                <div class="formula-section">
                    <h3>üßÆ Formula Calculations:</h3>
                    <div id="formulaSteps"></div>
                </div>
                
                <div class="debug-toggle">
                    <button class="debug-btn" onclick="toggleDebug()">üîç Show Debug Info</button>
                    <div class="debug-info" id="debugInfo"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script Web App URL - UPDATED WITH YOUR NEW URL
        const DEPLOYMENT_URL = 'https://script.google.com/a/macros/talabat.com/s/AKfycbyq_uofMc9mgEGp2f9-0duQkf3K9Rzo4ZdtlKKG_f0dg2JT_tU5EeuWu1i6xGfnKAwz8g/exec';
        
        let debugData = {};
        let currentResults = {};
        
        function toggleDebug() {
            const debug = document.getElementById('debugInfo');
            debug.style.display = debug.style.display === 'block' ? 'none' : 'block';
        }
        
        function analyzeOrder() {
            const details = document.getElementById('orderDetails').value.trim();
            const errorDiv = document.getElementById('errorMessage');
            const loadingDiv = document.getElementById('loading');
            const resultContainer = document.getElementById('resultContainer');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const exportBtn = document.getElementById('exportBtn');
            
            // Reset UI
            errorDiv.style.display = 'none';
            resultContainer.style.display = 'none';
            document.getElementById('debugInfo').style.display = 'none';
            document.getElementById('apiStatus').style.display = 'none';
            document.getElementById('debugOutput').style.display = 'none';
            exportBtn.disabled = true;
            
            // Validate input
            if (!details) {
                errorDiv.textContent = 'Please paste order details in the text area';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Show loading
            loadingDiv.style.display = 'block';
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Processing...';
            
            // Process the details
            setTimeout(() => {
                try {
                    const result = processOrderDetails(details);
                    debugData = result;
                    currentResults = result.columns;
                    
                    // Update result display
                    updateResultDisplay(result);
                    
                    // Enable export button
                    exportBtn.disabled = false;
                    
                    // Show result
                    resultContainer.style.display = 'block';
                    
                    // Update debug info
                    updateDebugInfo(result);
                    
                } catch (error) {
                    errorDiv.textContent = 'Error processing details: ' + error.message;
                    errorDiv.style.display = 'block';
                    console.error('Processing error:', error);
                } finally {
                    // Hide loading
                    loadingDiv.style.display = 'none';
                    analyzeBtn.disabled = false;
                    analyzeBtn.textContent = 'üöÄ Analyze Order';
                }
            }, 500);
        }
        
        // SIMPLE AND RELIABLE EXPORT FUNCTION
        async function exportToSheets() {
            const exportBtn = document.getElementById('exportBtn');
            const apiStatus = document.getElementById('apiStatus');
            
            // Validate that we have results
            if (!currentResults || Object.keys(currentResults).length === 0) {
                showApiStatus('Please analyze an order first', 'error');
                return;
            }
            
            // Prepare ALL data for export
            const exportData = {
                // Column mappings
                B: currentResults.B || 'N/A',           // Order ID
                C: currentResults.C || 'N/A',           // Country
                D: currentResults.D || 'N/A',           // Order Date
                E: currentResults.E || 'N/A',           // Ordered at
                F: currentResults.F || 'N/A',           // Queued At
                G: currentResults.G || 'N/A',           // Courier Notified
                H: currentResults.H || 'N/A',           // Accepted At
                I: currentResults.I || 'N/A',           // Near Pickup
                J: currentResults.J || 'N/A',           // Est. Pickup
                K: currentResults.K || 'N/A',           // Picked Up At
                L: currentResults.L || 'N/A',           // Est. Dropoff
                M: currentResults.M || 'N/A',           // Near Dropoff
                N: currentResults.N || 'N/A',           // PDT
                O: currentResults.O || 'N/A',           // food_is_ready_at
                P: currentResults.P || 'N/A',           // cancellation_time
                Q: currentResults.Q || 'N/A',           // old_cpt
                R: currentResults.R || 'N/A',           // cpt
                S: currentResults.S || 'N/A',           // is_wfa
                T: currentResults.T || 'N/A',           // Before PDT Check
                U: currentResults.U || 'N/A',           // System Late Duration
                V: currentResults.V || 'N/A',           // Vendor Late Duration
                W: currentResults.W || 'N/A',           // Rider Delay After Pickup
                X: currentResults.X || 'N/A',           // Rider Delay Before Pickup
                Y: currentResults.Y || 'N/A',           // Vendor Late (Near Pickup)
                Z: currentResults.Z || 'N/A',           // Late Owner
                
                // Additional data
                timestamp: new Date().toISOString(),
                orderDetails: document.getElementById('orderDetails').value.trim().substring(0, 50000)
            };
            
            console.log('Exporting data:', exportData);
            
            // Update UI
            exportBtn.disabled = true;
            exportBtn.textContent = 'Exporting...';
            showApiStatus('Preparing data for export...', 'info');
            
            try {
                // Build URL with ALL data as parameters
                const params = new URLSearchParams();
                Object.keys(exportData).forEach(key => {
                    params.append(key, exportData[key]);
                });
                
                const url = DEPLOYMENT_URL + '?' + params.toString();
                console.log('Export URL (first 200 chars):', url.substring(0, 200) + '...');
                
                // METHOD 1: Open in new tab (MOST RELIABLE for Google Apps Script)
                showApiStatus('Opening Google Apps Script in new tab...', 'info');
                const newTab = window.open(url, '_blank');
                
                // METHOD 2: Also try fetch for better feedback
                setTimeout(async () => {
                    try {
                        const response = await fetch(url);
                        const result = await response.json();
                        
                        if (result.success) {
                            showApiStatus('‚úÖ ' + result.message + ' (Row: ' + (result.details?.row || '?') + ')', 'success');
                        } else {
                            showApiStatus('‚ö†Ô∏è Server error: ' + (result.message || 'Unknown error'), 'error');
                        }
                    } catch (fetchError) {
                        // New tab method should work even if fetch fails
                        showApiStatus('‚úÖ Data sent via new tab. Check Google Sheets.', 'success');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Export error:', error);
                showApiStatus('‚ùå Error: ' + error.message, 'error');
            } finally {
                exportBtn.disabled = false;
                exportBtn.textContent = 'üì§ Export Results';
                
                // Auto-hide success message after 5 seconds
                setTimeout(() => {
                    const status = document.getElementById('apiStatus');
                    if (status.className.includes('api-success')) {
                        status.style.display = 'none';
                    }
                }, 5000);
            }
        }
        
        // Test connection function
        async function testConnection() {
            const testBtn = document.getElementById('testBtn');
            const apiStatus = document.getElementById('apiStatus');
            
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            showApiStatus('Testing connection to Google Apps Script...', 'info');
            
            try {
                const testUrl = DEPLOYMENT_URL + '?test=' + Date.now() + '&action=test';
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    const text = await response.text();
                    console.log('Test response:', text);
                    
                    try {
                        const json = JSON.parse(text);
                        showApiStatus('‚úÖ Connection successful! ' + (json.message || 'Script is running.'), 'success');
                    } catch {
                        showApiStatus('‚úÖ Connection successful! Script responded.', 'success');
                    }
                } else {
                    showApiStatus('‚ö†Ô∏è Connection established but got HTTP ' + response.status, 'error');
                }
            } catch (error) {
                showApiStatus('‚ùå Connection failed: ' + error.message, 'error');
                console.error('Connection test error:', error);
                
                // Try opening in new tab as fallback
                const testUrl = DEPLOYMENT_URL + '?test=' + Date.now();
                window.open(testUrl, '_blank');
                showApiStatus('‚ö†Ô∏è Fetch failed. Opened test link in new tab.', 'info');
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'üîß Test Connection';
            }
        }
        
        // Debug export - shows exactly what will be sent
        function debugExport() {
            const debugOutput = document.getElementById('debugOutput');
            const apiStatus = document.getElementById('apiStatus');
            
            if (!currentResults || Object.keys(currentResults).length === 0) {
                showApiStatus('Please analyze an order first', 'error');
                return;
            }
            
            // Prepare sample data
            const debugData = {
                B: currentResults.B || '12345',
                C: currentResults.C || 'AE',
                Z: currentResults.Z || 'Vendor Late',
                timestamp: new Date().toISOString()
            };
            
            const params = new URLSearchParams();
            Object.keys(debugData).forEach(key => {
                params.append(key, debugData[key]);
            });
            
            const url = DEPLOYMENT_URL + '?' + params.toString();
            
            debugOutput.innerHTML = `üîç DEBUG INFO:
            
üì§ Data being sent:
${JSON.stringify(debugData, null, 2)}

üîó URL being called (first 300 chars):
${url.substring(0, 300)}...

üìã Manual test instructions:
1. Click this link to test: <a href="${url}" target="_blank" style="color: #20c997; text-decoration: underline;">Test Link</a>
2. A new tab will open with the Google Apps Script
3. Wait for the JSON response
4. Check your Google Sheets for a new row
5. If no data appears, check:
   - Google Apps Script ‚Üí Executions (for logs)
   - Google Sheets for "Order Analysis Results" sheet
   
üõ†Ô∏è Quick checks:
‚Ä¢ Make sure you've saved the new Google Apps Script code
‚Ä¢ Check Google Sheets permissions
‚Ä¢ Look for CORS errors in browser console (F12)`;
            
            debugOutput.style.display = 'block';
            showApiStatus('Debug info displayed below. Click the Test Link.', 'info');
        }
        
        function showApiStatus(message, type = 'info') {
            const apiStatus = document.getElementById('apiStatus');
            apiStatus.textContent = message;
            apiStatus.className = 'api-status';
            
            if (type === 'success') {
                apiStatus.classList.add('api-success');
            } else if (type === 'error') {
                apiStatus.classList.add('api-error');
            } else if (type === 'info') {
                apiStatus.classList.add('api-info');
            }
            
            apiStatus.style.display = 'block';
        }
        
        // YOUR EXISTING ANALYSIS FUNCTIONS (keep all your original code here)
        // I'm including a placeholder - you should keep your full implementation
        
        function processOrderDetails(text) {
            // YOUR ORIGINAL processOrderDetails FUNCTION GOES HERE
            // Don't change this - keep all your B-Z calculations
            
            console.log('Processing order details...');
            
            // This is a simplified version - KEEP YOUR ORIGINAL CODE
            const result = {
                columns: {},
                timestamps: {},
                formulas: []
            };
            
            // Extract Order ID (B)
            const backendMatch = text.match(/(\d+)\s*Backend\s*Link/i);
            result.columns.B = backendMatch ? backendMatch[1].trim() : '';
            
            // Extract Country (C)
            let countryMatch = text.match(/TB_([A-Z]{2})/i);
            if (!countryMatch) {
                countryMatch = text.match(/HF_([A-Z]{2})/i);
            }
            result.columns.C = countryMatch ? countryMatch[1].trim() : '';
            
            // ... ALL YOUR ORIGINAL CODE FOR COLUMNS D-Z ...
            
            // For testing, add some sample data
            result.columns.Z = "Vendor Late";
            result.columns.E = "10:30:00 PM";
            result.columns.N = "11:15:00 PM";
            result.columns.V = "300s";
            result.columns.X = "150s";
            
            return result;
        }
        
        function updateResultDisplay(result) {
            // YOUR ORIGINAL updateResultDisplay FUNCTION
            const finalResult = document.getElementById('finalResult');
            const columnsGrid = document.getElementById('columnsGrid');
            const formulaSteps = document.getElementById('formulaSteps');
            
            // Set final result
            finalResult.textContent = result.columns.Z || 'No Result';
            finalResult.className = 'final-result ';
            
            if (result.columns.Z === "Before PDT") {
                finalResult.classList.add('result-before-pdt');
            } else if (result.columns.Z.includes("Vendor Late")) {
                finalResult.classList.add('result-vendor-late');
            } else if (result.columns.Z.includes("Rider Late")) {
                finalResult.classList.add('result-rider-late');
            } else if (result.columns.Z.includes("Long Dispatch")) {
                finalResult.classList.add('result-long-dispatch');
            } else {
                finalResult.classList.add('result-on-time');
            }
            
            // Create columns grid (simplified for example)
            let columnsHTML = `
                <div class="column-group">
                    <h3>Basic Information</h3>
                    <div class="column-item">
                        <div class="column-label">B: Order ID</div>
                        <div class="column-value">${result.columns.B || 'N/A'}</div>
                    </div>
                    <div class="column-item">
                        <div class="column-label">C: Country</div>
                        <div class="column-value">${result.columns.C || 'N/A'}</div>
                    </div>
                    <div class="column-item">
                        <div class="column-label">Z: Late Owner</div>
                        <div class="column-value">${result.columns.Z || 'N/A'}</div>
                    </div>
                </div>
            `;
            
            columnsGrid.innerHTML = columnsHTML;
            
            // Show formula steps
            formulaSteps.innerHTML = '<div class="formula-step">Analysis complete. Ready to export.</div>';
        }
        
        function updateDebugInfo(result) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.textContent = 'Debug information would appear here...';
        }
        
        // Helper function to get UTC offset for a country
        function getUTCOffsetForCountry(countryCode) {
            const countryUTCOffsets = {
                'AE': 4, 'EG': 2, 'KW': 3, 'QA': 3, 'IQ': 3,
                'SA': 3, 'JO': 2, 'BH': 3, 'OM': 4
            };
            return countryUTCOffsets[countryCode] || 4;
        }
        
        // Load test data on page load
        window.addEventListener('load', function() {
            document.getElementById('deploymentUrlDisplay').textContent = DEPLOYMENT_URL;
            
            // Optional: Load test data
            document.getElementById('orderDetails').value = `Hurrier
Search by


3376405101
Backend Link
Important Details
Status
In progress
(Since 01 Jan 11:09pm)
Platform
talabat
Global Entity ID
HF_EG
Vendor code
509562
Vendor Order no.
3784
Order Value
$297.49
Manhattan distance
6.33 KM
Prep duration (TES)
10m
Courier delay
14m
More Details
Pick up and Drop off
Vendor Address
House of Cocoa, Elsherouk
17 Cleopatra Street, Korba, Heliopolis , Cairo
Cairo
Apartment
NA
Zipcode
NA
Building
NA
Intercom
NA
Floor
NA
Entrance
NA
Elsherouk
Customer Address
Lara Lolita
+201554595895
Tariaq Bedon Esm Townhouse 69 Parcel 8 , ÿßŸÑŸÇÿßŸáÿ±ÿ©
ÿßŸÑŸÇÿßŸáÿ±ÿ©
Apartment
NA
Zipcode
NA
Building
NA
Intercom
NA
Floor
NA
Entrance
NA
Deadline -6 minutes 
Deliveries
1
Issues
Routes
Order Items

ID
132583660508389376
Status
Accepted
Zones
Shorouk city sp 1, Shorouk city sp 2
Courier
Utilization
29
Time	Event	Courier	Loc	Est.accept time	Est.pickup arrival	Est.pickup departure	Est.dropoff arrival	Est.dropoff departure	
10:40 PM	
Queued
-		-	-	
-
-	
-
10:40 PM	
Dispatched
Auto Dispatching
10:40 PM	10:49 PM	
10:52 PM
(18min)
11:15 PM	
11:15 PM
(0min)
10:40 PM	
Courier Notified
-	10:49 PM	
10:52 PM
(18min)
11:15 PM	
11:15 PM
(0min)
10:40 PM	
Accepted
-	10:49 PM	
10:52 PM
(18min)
11:15 PM	
11:15 PM
(0min)
10:49 PM	
Near Pickup
-	11:01 PM	
11:02 PM
(8min)
11:25 PM	
11:25 PM
(-10min)
11:09 PM	
Queued
Manual Undispatch
-	-	
-
-	
-
11:09 PM	
Dispatched
Auto Dispatching
11:09 PM	11:17 PM	
11:18 PM
(-7min)
11:41 PM	
11:41 PM
(-26min)
11:09 PM	
Courier Notified
-	11:17 PM	
11:18 PM
(-7min)
11:41 PM	
11:41 PM
(-26min)
11:09 PM	
Accepted
-	11:17 PM	
11:18 PM
(-7min)
11:41 PM	
11:41 PM
(-26min)
Notes
Empty state
Time Checks
Ordered at
Thu 01 Jan 10:40pm
Send to restaurant
10:40pm
Restaurant confirmed at
10:40pm
Pickup - Committed
10:50pm
Food is ready at
11:01pm
Promised delivery time
Thu 01 Jan 11:15pm`;
        });
    </script>
</body>
</html>
